# Character Sprite Builder - Documentation

## Overview
A React TypeScript application for creating layered character sprites with proper layer compositing and export functionality for game development.

## Key Features

### Layer System
- **Characters**: Base character sprites (bottom layer)
- **Clothes**: Clothing and outfit layers
- **Eyes**: Eye and makeup layers
- **Hair**: Hair style layers  
- **Accessories**: Hats, glasses, beards, etc. (top layer)

### Layer Ordering (Bottom to Top)
1. Characters (base)
2. Clothes
3. Eyes
4. Hair
5. Accessories

### Export Formats

#### 1. PNG Export
- Exports the composited sprite as a PNG image
- Maintains pixel-perfect rendering
- Filename: `character-sprite-{timestamp}.png`

#### 2. JSON Export
- Contains complete layer information for reconstruction
- Includes canvas dimensions, layer order, and metadata
- Filename: `character-sprite-{timestamp}.json`

**JSON Structure:**
```json
{
  "timestamp": "2024-12-21T...",
  "canvasSize": {
    "width": 256,
    "height": 256
  },
  "layers": [
    {
      "category": "characters",
      "filename": "char1.png",
      "displayName": "Characters",
      "path": "/assets/characters/char1.png",
      "zIndex": 0
    }
  ],
  "metadata": {
    "totalLayers": 5,
    "activeLayers": 3,
    "exportFormat": "character-sprite-builder-v1"
  }
}
```

#### 3. Godot Resource Export (.tres)
- Exports as Godot-compatible resource file
- Ready for direct import into Godot projects
- Filename: `character-sprite-{timestamp}.tres`

**Godot Resource Structure:**
```
[gd_resource type="Resource" format=3]

[resource]
canvas_width = 256
canvas_height = 256
layers = [
  {
    "category": "characters",
    "filename": "char1.png",
    "path": "/assets/characters/char1.png",
    "z_index": 0
  }
]
```

## Implementation Patterns

### Component Architecture
- **App.tsx**: Main application state management
- **SpriteCanvas.tsx**: Canvas rendering and layer compositing
- **LayerSelector.tsx**: Asset selection interface with thumbnails
- **ExportPanel.tsx**: Export functionality UI

### Asset Management
- **assetLoader.ts**: Centralized asset definitions and utilities
- **exportUtils.ts**: Export functionality for different formats

### Styling
- Uses `tailwind-variants` for component styling variations
- Pixel-perfect rendering with `imageRendering: 'pixelated'`
- Responsive grid layouts for asset selection

## Technical Details

### Canvas Rendering
- Proper layer compositing order
- Maintains aspect ratios during scaling
- Non-smoothed rendering for pixel art
- Dynamic canvas sizing based on sprite dimensions

### Asset Loading
- Efficient image caching system
- Error handling for missing assets
- Thumbnail preview generation

### Export System
- Multiple format support (PNG, JSON, Godot)
- Timestamped filenames to prevent overwrites
- Complete layer metadata preservation

## Usage in Godot

### Loading Exported Resources
```gdscript
# Load the exported .tres file
var sprite_data = load("res://exports/character-sprite-123456.tres")

# Access layer information
for layer in sprite_data.layers:
    print("Layer: ", layer.category)
    print("File: ", layer.filename)
    print("Z-Index: ", layer.z_index)
```

### Reconstructing Sprites
```gdscript
# Create sprite nodes for each layer
for layer in sprite_data.layers:
    var sprite = Sprite2D.new()
    sprite.texture = load("res://assets/" + layer.category + "/" + layer.filename)
    sprite.z_index = layer.z_index
    add_child(sprite)
```

## Development Guidelines
- All components use CamelCase naming (e.g., `SpriteCanvas`)
- TypeScript types preferred over interfaces
- Asset paths centralized in `assetLoader.ts`
- Export utilities separated for maintainability
- Error handling for all file operations 